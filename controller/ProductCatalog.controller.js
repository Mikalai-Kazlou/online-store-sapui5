sap.ui.define(["./BaseController","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/model/ChangeReason","sap/ui/layout/cssgrid/GridBoxLayout","sap/m/ButtonType"],function(t,e,i,o,n,s,r,a){"use strict";return t.extend("com.exercise.onlinestoresapui5.controller.ProductCatalog",{onInit:function(){const t=this.getRouter();t.getRoute("main").attachPatternMatched(this._onPatternMatched,this)},_onPatternMatched:function(){const t=this.byId("idProductCatalog");const e=t.getItems();this._setAddToCartButtonsAttributes(e)},createProductCatalogListContent:function(t){const e=this.byId("idListViewSelector");let i="idListItemLarge";let o={boxMinWidth:"22rem"};if(e.getSelectedKey()==="list"){i="idListItemSmall";o={boxMinWidth:"100%"}}const n=this.byId(i).clone(t);const s=new r(o);const a=this.byId("idProductCatalog");a.setCustomLayout(s);return n},onListViewSelectorChange:function(t){const e=this.byId("idProductCatalog");const i=e.getBinding("items");i.refresh(true);e.updateAggregation("items",s.Refresh)},onOpenDetails:function(t){const e=t.getSource();this.navTo("details",{id:e.getBindingContext("mockdata").getObject().ID})},onProductCatalogUpdateFinished(t){const e=t.getSource();const i=e.getItems();const o=i.map(t=>t.getBindingContext("mockdata").getObject());this._setRangeFilterAttributes(this.byId("idFilterPrice"),o,"Price");this._setRangeFilterAttributes(this.byId("idFilterStock"),o,"Stock");this._setAddToCartButtonsAttributes(i)},_setAddToCartButtonsAttributes:function(t){t.forEach(t=>{const e=t.getBindingContext("mockdata").getObject();const i=t.getContent()[0].getControlsByFieldGroupId("idAddToCartButtonGroup")[0];this._setAddToCartButtonAttributes(e.ID,i)})},_setAddToCartButtonAttributes:function(t,e){const i=this.getResourceBundle();if(this.oCart.has(t)){e.setType(a.Success);e.setText(i.getText("productCatalogDropFromCartButtonText"))}else{e.setType(a.Default);e.setText(i.getText("productCatalogAddToCartButtonText"))}},_setRangeFilterAttributes:function(t,e,i){if(!t.getRange()[0]){const o=e.reduce((t,e)=>t<e[i]?t:e[i],Number.MAX_SAFE_INTEGER);const n=e.reduce((t,e)=>t>e[i]?t:e[i],0);t.setMin(o);t.setMax(n);t.setRange([o,n])}},onSortingChange:function(t){const e=t.getSource();const i=e.getSelectedKey();const[o,s]=i.split("-");const r=this.byId("idProductCatalog");const a=r.getBinding("items");a.sort([new n(o,Boolean(s))])},_applyFilters:function(t,e){const o=this.byId("idProductCatalog");const n=o.getBinding("items");let s=n.getFilters(i.Application);s=s.filter(t=>t.getPath()!==e);s=s.concat(...t);n.filter(s,i.Application)},_applyTextFilter:function(t,i){const n=[];const s=t.getValue();if(s&&s.length>0){n.push(new e(i,o.Contains,s))}this._applyFilters(n,i)},_applyListFilter:function(t,i){const n=[];const s=t.getSelectedItems();s.forEach(t=>{n.push(new e(i,o.EQ,t.getTitle()))});this._applyFilters(n,i)},_applyRangeFilter:function(t,i){const n=[];const[s,r]=t.getRange().sort((t,e)=>t-e);if(s!==t.getMin()||r!==t.getMax()){n.push(new e(i,o.BT,s,r))}this._applyFilters(n,i)},onClearFilters:function(){const t=this.byId("idFilterSearch");t.setValue("");this._applyTextFilter(t,"Title");const e=this.byId("idFilterCategory");e.removeSelections(true);this._applyListFilter(e,"Category");const i=this.byId("idFilterBrand");i.removeSelections(true);this._applyListFilter(i,"Brand");const o=this.byId("idFilterPrice");o.setRange([o.getMin(),o.getMax()]);this._applyRangeFilter(o,"Price");const n=this.byId("idFilterStock");n.setRange([n.getMin(),n.getMax()]);this._applyRangeFilter(n,"Stock")},onSearch:function(t){this._applyTextFilter(t.getSource(),"Title")},onFilterCategorySelectionChange:function(t){this._applyListFilter(t.getSource(),"Category")},onFilterBrandSelectionChange:function(t){this._applyListFilter(t.getSource(),"Brand")},onFilterPriceChange:function(t){this._applyRangeFilter(t.getSource(),"Price")},onFilterStockChange:function(t){this._applyRangeFilter(t.getSource(),"Stock")},onAddToCart:function(t){const e=t.getSource();const i=e.getBindingContext("mockdata");const o=i.getObject();if(!this.oCart.has(o.ID)){this.oCart.add(o.ID,1,o.Price)}else{this.oCart.drop(o.ID)}this._refreshCartModel();this._refreshLocalDataModel();this._setAddToCartButtonAttributes(o.ID,e)},onFilterPanelExpand:function(t){const e=t.getParameters();const i=this.byId("idFiltersTitle");i.setVisible(e.expand);const o=this.byId("idFiltersClearButton");o.setVisible(e.expand)}})});
//# sourceMappingURL=ProductCatalog.controller.js.map